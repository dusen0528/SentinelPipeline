# 프로젝트 정의
## 프로젝트 개요

**SentinelPipeline**은 RTSP(Real-Time Streaming Protocol) 다중 스트림을 입력받아 실시간으로 AI 감지(화재, 비명, 침입 등)와 영상 변형(얼굴 블러 등)을 수행하는 모듈형 파이프라인 엔진입니다.

### 핵심 특징

- **모듈형 파이프라인**: 감지 및 변형 모듈을 플러그인 방식으로 추가/제거 가능
- **Clean Architecture**: 4계층 분리로 유지보수성과 확장성 확보
- **설정 기반 운영**: 코드 수정 없이 설정 파일만으로 동작 제어
- **장애 격리**: 개별 모듈의 오류가 전체 파이프라인에 영향 없음
- **자동 복구**: 스트림 끊김 시 지수 백오프 방식으로 자동 재연결

---

### 기존 시스템의 한계

영상 관제 서비스를 구축할 때 흔히 마주치는 문제들이 있습니다:

1. **납품사별 커스터마이징의 어려움**
    - 각 고객사마다 요구사항이 다름 (화재 감지만 필요한 곳, 얼굴 블러가 필요한 곳 등)
    - 코드를 수정하면 다른 고객사에 배포할 때마다 분기 처리 필요
    - 유지보수가 복잡해짐
2. **모듈 간 결합도가 높음**
    - 화재 감지 모듈이 오류를 발생시키면 전체 파이프라인이 중단
    - 새로운 감지 모듈을 추가하려면 기존 코드를 수정해야 함
3. **설정 변경이 어려움**
    - 모듈 활성화/비활성화를 위해 코드 수정 필요
    - 런타임에 설정 변경 불가
4. **테스트와 확장의 어려움**
    - 각 모듈을 독립적으로 테스트하기 어려움
    - 새로운 AI 모델을 통합하려면 전체 시스템을 이해해야 함

### 해결하고자 하는 문제

이러한 문제들을 해결하기 위해 다음과 같은 목표를 설정했습니다:

1. **코드 수정 없이 설정만으로 동작 제어**
    - `config.json`과 `.env` 파일만 수정하면 납품사별 커스터마이징 가능
    - 런타임에 모듈 활성화/비활성화 및 설정 변경 가능
2. **모듈 간 독립성 보장**
    - 개별 모듈의 오류가 다른 모듈에 영향 없음
    - 모듈 추가/제거가 기존 코드 수정 없이 가능
3. **확장 가능한 아키텍처**
    - 새로운 AI 모델을 플러그인 형태로 쉽게 추가 (모델은 추후 단계별로 개발)
    - 각 모듈을 독립적으로 개발 및 테스트 가능
4. **운영 편의성**
    - REST API로 스트림 제어
    - 웹 대시보드로 실시간 모니터링
    - Prometheus 메트릭으로 성능 추적

---

## 시스템 아키텍처

### 전체 구조

![image.png](attachment:61f8438f-6166-40f7-b824-5d986c928bcb:image.png)

각 계층은 안쪽 계층만 참조하며, 바깥쪽 계층은 안쪽 계층을 알지 못합니다. 이를 통해 의존성 방향을 명확히 하고, 각 계층을 독립적으로 테스트하고 확장할 수 있습니다.

---

## 기술 스택

### 언어 및 프레임워크

- **Python 3.10+**: 메인 개발 언어
- **FastAPI**: REST API 서버
- **uv**: 패키지 관리 (pyproject.toml 기반)

### 핵심 라이브러리

- **OpenCV**: RTSP 스트림 디코딩
- **FFmpeg**: 영상 인코딩 및 퍼블리싱
- **ONNX Runtime / PyTorch**: AI 모델 추론 (추후 모델 개발 시 사용)
- **loguru**: 구조화 로깅
- **Pydantic v2**: 설정 검증

### 아키텍처 원칙

- **Clean Architecture**: 계층 분리 및 의존성 규칙
- **SOLID 원칙**: 특히 Single Responsibility, Dependency Inversion
- **Protocol 기반 설계**: 타입 안전성과 유연성 확보

---

## 참고 자료

- [프로젝트 GitHub 저장소](https://github.com/your-repo/sentinel-pipeline) (예정)
- [Clean Architecture - Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [프로젝트 아키텍처 문서](https://www.notion.so/architecture.md)